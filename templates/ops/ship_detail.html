{% extends "base.html" %}
{% block title %}{{ ship.name }} · C.K.F.R{% endblock %}
{% block body %}
<div class="max-w-5xl mx-auto p-4 sm:p-6 space-y-8">

  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl sm:text-3xl font-semibold">{{ ship.name }}</h1>
      <p class="text-slate-300">Équipage {{ ship.min_crew }}–{{ ship.max_crew }}</p>
    </div>
  </div>

  {% if can_edit %}
  <div class="rounded-xl border border-white/10 bg-white/5 p-4">
    <h2 class="font-medium mb-3">Ajouter un modèle de rôle</h2>
    <form method="post" class="grid sm:grid-cols-3 gap-3">
      {% csrf_token %}
      {{ role_form.role_name }}
      {{ role_form.slots }}
      <button class="rounded-lg bg-indigo-600 hover:bg-indigo-500 px-3 py-2">Ajouter</button>
    </form>
    <p class="text-xs text-slate-400 mt-2">Les places manquantes sont créées automatiquement.</p>
  </div>
  {% endif %}

  {% for role, slots in slots_by_role.items %}
    <div class="rounded-xl border border-white/10 bg-white/5 p-4">
      <div class="font-medium mb-3">{{ role }}</div>
      <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-3">
        {% for s in slots %}
          <form method="post" action="{% url 'role_slot_update' s.pk %}" class="rounded-lg bg-white/10 p-3">
            {% csrf_token %}
            <div class="text-sm text-slate-300 mb-2">Place #{{ s.index }}</div>
            <select name="user" class="w-full bg-white/5 border border-white/10 rounded px-2 py-1 mb-2">
              <option value="">— libre —</option>
              {% for u in request.user.__class__.objects.all %}
                <option value="{{ u.id }}" {% if s.user_id == u.id %}selected{% endif %}>{{ u.username }}</option>
              {% endfor %}
            </select>
            <select name="status" class="w-full bg-white/5 border border-white/10 rounded px-2 py-1 mb-2">
              <option value="open" {% if s.status == 'open' %}selected{% endif %}>Libre</option>
              <option value="assigned" {% if s.status == 'assigned' %}selected{% endif %}>Assigné</option>
              <option value="confirmed" {% if s.status == 'confirmed' %}selected{% endif %}>Confirmé</option>
            </select>
            <button class="w-full rounded bg-indigo-600 hover:bg-indigo-500 px-3 py-1.5">Enregistrer</button>
          </form>
        {% endfor %}
      </div>
    </div>
  {% empty %}
    <p class="text-slate-300">Aucun rôle défini pour ce vaisseau.</p>
  {% endfor %}

</div>
{% endblock %}
